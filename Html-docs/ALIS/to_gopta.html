<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of to_gopta</title>
  <meta name="keywords" content="to_gopta">
  <meta name="description" content="TO_GOPTA - Produce ALIS gopta files (experiment control files)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- menu.html ALIS -->
<h1>to_gopta
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>TO_GOPTA - Produce ALIS gopta files (experiment control files)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function OK = to_gopta(experiment_name,stations,start_stop,cycle_lengths,filter_seq,postitions,exptimes,img_intervals,GT,ops) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> TO_GOPTA - Produce ALIS gopta files (experiment control files)
 
 THIS IS OUTRDATED! Worked for an earlier version of gopta. This
 should be updated!
 TODO: Update this to the current version of gopta.

 Calling:
 OK = to_gopta(experiment_name,stations,start_stop,cycle_lengths,filter_seq,postitions,exptimes,img_intervals,GT,ops)

 Input:
   EXPERIMENT_NAME - name of experiments, string 
   STATIONS - stations to be used in the experiment, cell array [1xN]
              ex: {'Abisko','Kiruna','bus'} 
   START_STOP - Start and stop times of experiment name, Start
                time should rather be seen as sync-time, cell
                array [2xN], ex: 
                {'15:00:00'    '15:00:00'    '15:00:00'
                 '21:05:00'    '21:05:00'    '21:05:00'}
   CYCLE_LENGTHS - number of steps in filter sequence, int array
                   [1xN], ex: [2 1 2]
   FILTER_SEQ - filter sequence, cell array, [max(CYCLE_LENGTH)xN],
                ex: {'6300','4278','5577'
                     '4278','4278','8446'}
   POSITIONS - camera rotations, or predefined positions, cell
               array,  [1xN] or [max(CYCLE_LENGTH)xN], ex:
               {'heating','heating',''}
   EXPTIMES - exposure times (ms), int array [max(CYCLE_LENGTH)xN]
   IMG_INTERVAL - interval between successive exposures (s) array
                  [max(CYCLE_LENGTH)xN]
   GT - Gain table for camera set-up, this controls the camera
        read-out speed, read noise, and sensitivity.
   OPS - Additional parameters to set, struct with fields:
         binning, object, observer

 See also EISCAT_ALIS200411</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../tools/ischar.html" class="code" title="function TrueOrFalse = ischar(str)">ischar</a>	ISCHAR - return true if STR is a char-array</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../ALIS/Gopta-exps/ALIS200412_DELTA.html" class="code" title="">ALIS200412_DELTA</a>	%% Set up creation program for supporting observations of the</li><li><a href="../ALIS/Gopta-exps/ALIS_heating200503.html" class="code" title="">ALIS_heating200503</a>	%% Stations in operation</li><li><a href="../ALIS/Gopta-exps/ALIS_heating200510.html" class="code" title="">ALIS_heating200510</a>	Creates ALIS experiment set up for EISCAT Heating campaign</li><li><a href="../ALIS/Gopta-exps/ALIS_rapid_aeronomi.html" class="code" title="">ALIS_rapid_aeronomi</a>	%% Stations in operation</li><li><a href="../ALIS/Gopta-exps/Eiscat_ALIS200411.html" class="code" title="">Eiscat_ALIS200411</a>	Script used to make gopta experiment configuration file for</li><li><a href="../ALIS/Gopta-exps/Eiscat_ALIS20056.html" class="code" title="">Eiscat_ALIS20056</a>	Script used to make gopta experiment configuration file for</li><li><a href="../ALIS/Gopta-exps/INDEX1.html" class="code" title="">INDEX1</a>	Creates ALIS experiment set up for EISCAT Heating campaign</li><li><a href="../ALIS/Gopta-exps/aindex1.html" class="code" title="">aindex1</a>	Script used to make gopta experiment configuration file for</li><li><a href="../ALIS/Gopta-exps/h2006_5mn.html" class="code" title="">h2006_5mn</a>	% to_gopta - how to</li><li><a href="../ALIS/Gopta-exps/kst.html" class="code" title="">kst</a>	Script used to make gopta experiment configuration file for</li><li><a href="../ALIS/Gopta-exps/rgbi8.html" class="code" title="">rgbi8</a>	Script used to make gopta experiment configuration file for</li><li><a href="../ALIS/Gopta-exps/tindex1.html" class="code" title="">tindex1</a>	Script used to make gopta experiment configuration file for</li><li><a href="../ALIS/Gopta-exps/tindex1_k.html" class="code" title="">tindex1_k</a>	Script used to make gopta experiment configuration file for</li><li><a href="../ALIS/Gopta-exps/tindex2.html" class="code" title="">tindex2</a>	Script used to make gopta experiment configuration file for</li><li><a href="../ALIS/Gopta-exps/tindex3.html" class="code" title="">tindex3</a>	Script used to make gopta experiment configuration file for</li><li><a href="../ALIS/Gopta-exps/to_gopta_explained.html" class="code" title="">to_gopta_explained</a>	% to_gopta - how to</li><li><a href="../ALIS/Gopta-exps/trakigt.html" class="code" title="">trakigt</a>	Script used to make gopta experiment configuration file for</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function ok = gopta_fig(stns,interv,expt,filters,expname)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function OK = to_gopta(experiment_name,stations,start_stop,cycle_lengths,filter_seq,postitions,exptimes,img_intervals,GT,ops)</a>
0002 <span class="comment">% TO_GOPTA - Produce ALIS gopta files (experiment control files)</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% THIS IS OUTRDATED! Worked for an earlier version of gopta. This</span>
0005 <span class="comment">% should be updated!</span>
0006 <span class="comment">% TODO: Update this to the current version of gopta.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Calling:</span>
0009 <span class="comment">% OK = to_gopta(experiment_name,stations,start_stop,cycle_lengths,filter_seq,postitions,exptimes,img_intervals,GT,ops)</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Input:</span>
0012 <span class="comment">%   EXPERIMENT_NAME - name of experiments, string</span>
0013 <span class="comment">%   STATIONS - stations to be used in the experiment, cell array [1xN]</span>
0014 <span class="comment">%              ex: {'Abisko','Kiruna','bus'}</span>
0015 <span class="comment">%   START_STOP - Start and stop times of experiment name, Start</span>
0016 <span class="comment">%                time should rather be seen as sync-time, cell</span>
0017 <span class="comment">%                array [2xN], ex:</span>
0018 <span class="comment">%                {'15:00:00'    '15:00:00'    '15:00:00'</span>
0019 <span class="comment">%                 '21:05:00'    '21:05:00'    '21:05:00'}</span>
0020 <span class="comment">%   CYCLE_LENGTHS - number of steps in filter sequence, int array</span>
0021 <span class="comment">%                   [1xN], ex: [2 1 2]</span>
0022 <span class="comment">%   FILTER_SEQ - filter sequence, cell array, [max(CYCLE_LENGTH)xN],</span>
0023 <span class="comment">%                ex: {'6300','4278','5577'</span>
0024 <span class="comment">%                     '4278','4278','8446'}</span>
0025 <span class="comment">%   POSITIONS - camera rotations, or predefined positions, cell</span>
0026 <span class="comment">%               array,  [1xN] or [max(CYCLE_LENGTH)xN], ex:</span>
0027 <span class="comment">%               {'heating','heating',''}</span>
0028 <span class="comment">%   EXPTIMES - exposure times (ms), int array [max(CYCLE_LENGTH)xN]</span>
0029 <span class="comment">%   IMG_INTERVAL - interval between successive exposures (s) array</span>
0030 <span class="comment">%                  [max(CYCLE_LENGTH)xN]</span>
0031 <span class="comment">%   GT - Gain table for camera set-up, this controls the camera</span>
0032 <span class="comment">%        read-out speed, read noise, and sensitivity.</span>
0033 <span class="comment">%   OPS - Additional parameters to set, struct with fields:</span>
0034 <span class="comment">%         binning, object, observer</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% See also EISCAT_ALIS200411</span>
0037 
0038 <span class="comment">% Copyright Bjorn Gustavsson 20050112</span>
0039 
0040 <span class="comment">%   Copyright Â© 20050112 Bjorn Gustavsson, &lt;bjorn.gustavsson@irf.se&gt;</span>
0041 <span class="comment">%   This is free software, licensed under GNU GPL version 2 or later</span>
0042 
0043 OK = 1;
0044 <span class="keyword">for</span> i = 1:length(stations)
0045   
0046   [success,mess,messid] = mkdir(upper(stations{i}(1)));
0047   
0048 <span class="keyword">end</span>
0049 
0050 <a href="#_sub1" class="code" title="subfunction ok = gopta_fig(stns,interv,expt,filters,expname)">gopta_fig</a>(stations,img_intervals,exptimes,filter_seq,experiment_name);
0051 <span class="keyword">if</span> ~exist(<span class="string">'filter_seq'</span>,<span class="string">'dir'</span>)
0052   mkdir(<span class="string">'filter_seq'</span>)
0053 <span class="keyword">end</span>
0054 eval([<span class="string">'print -depsc2 '</span>,[<span class="string">'filter_seq/'</span>,experiment_name]])
0055 eval([<span class="string">'print -dpng '</span>,[<span class="string">'filter_seq/'</span>,experiment_name]])
0056 
0057 <span class="keyword">for</span> i = 1:length(stations)
0058   
0059   fname = [upper(stations{i}(1)),<span class="string">'/'</span>,experiment_name];
0060   <span class="keyword">if</span> all(fname(end-1:end)~=<span class="string">'.g'</span>)
0061     fname = [fname,<span class="string">'.g'</span>];
0062   <span class="keyword">end</span>
0063   fp = fopen(fname,<span class="string">'w'</span>);
0064   
0065   fprintf(fp,<span class="string">'#%s\n\n'</span>,experiment_name);
0066   <span class="keyword">if</span> isfield(ops,<span class="string">'object'</span>)
0067     fprintf(fp,<span class="string">'%s\n'</span>,[<span class="string">'object '</span>,ops.object]);
0068   <span class="keyword">end</span>
0069   <span class="keyword">if</span> isfield(ops,<span class="string">'observer'</span>)
0070     fprintf(fp,<span class="string">'%s\n\n'</span>,[<span class="string">'observer '</span>,ops.observer]);
0071   <span class="keyword">end</span>
0072   fprintf(fp,<span class="string">'load stdpos\n'</span>);
0073   
0074   <span class="keyword">if</span> abs(round(cycle_lengths(i))-cycle_lengths(i))&gt;eps
0075     error(<span class="string">'Experiment cycle lengths should be integers...'</span>)
0076   <span class="keyword">end</span>
0077   indx_ss = min(i,size(start_stop,2));
0078   indx_fs = min(i,size(filter_seq,2));
0079   indx_ps = min(i,size(postitions,2));
0080   indx_is = min(i,size(img_intervals,2));
0081   indx_es = min(i,size(exptimes,2));
0082   
0083   <span class="keyword">if</span> ~isempty(start_stop{1,indx_ss})
0084     fprintf(fp,<span class="string">'set t gopta.start %s\n'</span>,start_stop{1,indx_ss});
0085   <span class="keyword">end</span>
0086   
0087   <span class="keyword">if</span> ~isempty(start_stop{2,indx_ss})
0088     fprintf(fp,<span class="string">'set t gopta.stop %s\n\n'</span>,start_stop{2,indx_ss});
0089   <span class="keyword">end</span>
0090   fprintf(fp,<span class="string">'set i gopta.items %d\n\n'</span>,round(cycle_lengths(i)));
0091   <span class="keyword">for</span> j = 1:cycle_lengths(i),
0092     fprintf(fp,<span class="string">'set i gopta.interval%d %d\n'</span>,j-1,img_intervals(j,indx_is));
0093   <span class="keyword">end</span>
0094   fprintf(fp,<span class="string">'\n'</span>);
0095   <span class="keyword">for</span> j = 1:cycle_lengths(i),
0096     fprintf(fp,<span class="string">'set i gopta.expose%d %d\n'</span>,j-1,exptimes(j,indx_es));
0097   <span class="keyword">end</span>
0098   fprintf(fp,<span class="string">'\n'</span>);
0099   
0100   <span class="keyword">for</span> j = 1:cycle_lengths(i),
0101     
0102     <span class="keyword">if</span> all(filter_seq{j,indx_fs} == filter_seq{1+mod(j-2+cycle_lengths(i),cycle_lengths(i)),indx_fs})
0103       <span class="keyword">if</span> j==1
0104         fprintf(fp,<span class="string">'filter %s\n'</span>,filter_seq{j,indx_fs});
0105       <span class="keyword">end</span>
0106       filter_seq{j,indx_fs} = <span class="string">'hold'</span>;
0107     <span class="keyword">end</span>
0108     <span class="keyword">if</span> ~<a href="../tools/ischar.html" class="code" title="function TrueOrFalse = ischar(str)">ischar</a>(filter_seq{j,indx_fs})
0109       filter_seq{j,indx_fs} = num2str(filter_seq{j,indx_fs});
0110     <span class="keyword">end</span>
0111     fprintf(fp,<span class="string">'set s gopta.filter%d %s\n'</span>,j-1,filter_seq{j,indx_fs});
0112     
0113   <span class="keyword">end</span>
0114   fprintf(fp,<span class="string">'\n'</span>);
0115   <span class="keyword">if</span> min(size(postitions))==1
0116     
0117     <span class="keyword">for</span> j = 1:cycle_lengths(i),
0118       fprintf(fp,<span class="string">'set s gopta.position%d %s\n'</span>,j-1,<span class="string">'hold'</span>);
0119     <span class="keyword">end</span>
0120     <span class="keyword">if</span> ~isempty(postitions{i})
0121       fprintf(fp,<span class="string">'position %s\n'</span>,postitions{i});
0122     <span class="keyword">end</span>
0123     
0124   <span class="keyword">else</span>
0125     
0126     <span class="keyword">for</span> j = 1:cycle_lengths(i),
0127       <span class="keyword">if</span> all(postitions{j,indx_ps} == postitions{1+mod(j-2+cycle_lengths(i),cycle_lengths(i)),indx_ps})
0128         <span class="keyword">if</span> j==1
0129           fprintf(fp,<span class="string">'position %s'</span>,postitions{j,indx_fs});
0130         <span class="keyword">end</span>
0131         postitions{j,indx_fs} = <span class="string">'hold'</span>;
0132       <span class="keyword">end</span>
0133       fprintf(fp,<span class="string">'set s gopta.position%d %d\n'</span>,j-1,postitions{j,indx_ps});
0134     <span class="keyword">end</span>
0135     
0136   <span class="keyword">end</span>
0137   fprintf(fp,<span class="string">'\n'</span>);
0138   <span class="keyword">if</span> ~isempty(GT{i})
0139     fprintf(fp,<span class="string">'play off\n'</span>);
0140     fprintf(fp,<span class="string">'new GT,%s\n'</span>,GT{i});
0141   <span class="keyword">end</span>
0142   <span class="keyword">if</span> isfield(ops,<span class="string">'binning'</span>)
0143     fprintf(fp,<span class="string">'%s\n'</span>,[<span class="string">'binning '</span>,ops.binning]);
0144     fprintf(fp,<span class="string">'hw\n'</span>);
0145     fprintf(fp,<span class="string">'play\n'</span>);
0146     fprintf(fp,<span class="string">'play knapsu\n'</span>);
0147   <span class="keyword">end</span>
0148   fclose(fp);
0149   
0150 <span class="keyword">end</span>
0151 
0152 
0153 <a name="_sub1" href="#_subfunctions" class="code">function ok = gopta_fig(stns,interv,expt,filters,expname)</a>
0154 <span class="comment">% GOPTA_FIG - produce an overview figure of the experiment</span>
0155 <span class="comment">%</span>
0156 
0157 expnmn = <span class="string">''</span>;
0158 <span class="keyword">if</span> nargin &gt; 4
0159   expnmn = [<span class="string">': '</span>,expname];
0160 <span class="keyword">end</span>
0161 clf
0162 load Spectr_cmap
0163 spec_wide = interp1([Lambda 850],[Spectr_cmap;0 0 0],[Lambda,(max(Lambda)+1):850],<span class="string">'pchip'</span>);
0164 Lambda = [Lambda,(max(Lambda)+1):850];
0165 hold on
0166 
0167 <span class="keyword">for</span> i = 1:length(stns)
0168   hold on
0169   
0170   <span class="keyword">for</span> j = 1:length(interv(:,i)),
0171     <span class="comment">%filters{j,i}</span>
0172     c = interp1(Lambda,spec_wide,str2num(filters{j,i})/10);
0173     ph = patch(sum(interv(1:j-1,i))+<span class="keyword">...</span>
0174                [0 expt(j,i)/1000 expt(j,i)/1000 0 0],<span class="keyword">...</span>
0175                -i+[.4 .4 -.4 -.4 .4],c);
0176     
0177     <span class="keyword">if</span> j == length(interv(:,i))
0178       ax = axis;
0179       ax(2) = max(sum(interv));
0180       text(max(-ax(2)/7,-25),-i,<span class="keyword">...</span>
0181            [upper(stns{i}(1)),stns{i}(2:end)],<span class="string">'FontWeight'</span>,<span class="string">'bold'</span>,<span class="string">'fontsize'</span>,16)
0182       plot([0,ax(2)],-i+[.4 .4],<span class="string">'k--'</span>)
0183       plot([0,ax(2)],-i-[.4 .4],<span class="string">'k--'</span>)
0184     <span class="keyword">end</span>
0185     
0186   <span class="keyword">end</span>
0187 <span class="keyword">end</span>
0188 axis(ax)
0189 
0190 set(gca,<span class="string">'yticklabel'</span>,<span class="string">''</span>)
0191 xlabel(<span class="string">'time (s)'</span>,<span class="string">'fontsize'</span>,16)
0192 title([<span class="string">'Filter/exposure sequence'</span>,expnmn],<span class="string">'fontsize'</span>,18,<span class="string">'Interpreter'</span>,<span class="string">'none'</span>)
0193 
0194 <span class="keyword">if</span> nargout
0195   
0196   ok = 1;
0197   
0198 <span class="keyword">end</span>
0199 <span class="comment">% $$$ #Knutstorp:</span>
0200 <span class="comment">% $$$ object Gopta test</span>
0201 <span class="comment">% $$$ observer U. Br%Gï¿½%@ndstr%Gï¿½%@m</span>
0202 <span class="comment">% $$$ set i gopta.items 3</span>
0203 <span class="comment">% $$$ set t gopta.start 20:10:00</span>
0204 <span class="comment">% $$$ set t gopta.stop  20:14:00</span>
0205 <span class="comment">% $$$ #</span>
0206 <span class="comment">% $$$ set i gopta.interval0 10</span>
0207 <span class="comment">% $$$ set i gopta.interval1 20</span>
0208 <span class="comment">% $$$ set i gopta.interval2 30</span>
0209 <span class="comment">% $$$ set s gopta.filter0   5577</span>
0210 <span class="comment">% $$$ set s gopta.filter1   6300</span>
0211 <span class="comment">% $$$ set s gopta.filter2   4278</span>
0212 <span class="comment">% $$$ set s gopta.position0 hold</span>
0213 <span class="comment">% $$$ set s gopta.position1 hold</span>
0214 <span class="comment">% $$$ set s gopta.position2 hold</span>
0215 <span class="comment">% $$$ set i gopta.expose0   1000</span>
0216 <span class="comment">% $$$ set i gopta.expose1   2000</span>
0217 <span class="comment">% $$$ set i gopta.expose2   3000</span>
0218 <span class="comment">% $$$ set s core 0,0</span>
0219</pre></div>
<hr><address>Generated on Sat 09-Feb-2013 12:20:36 by <strong>B.&nbsp;Gustavsson</strong> with <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>