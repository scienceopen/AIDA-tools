<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Spec_cal_jobb_Miracle</title>
  <meta name="keywords" content="Spec_cal_jobb_Miracle">
  <meta name="description" content="Spec_cal_jobb_Miracle - Example of spectral camera sensitivity calibration">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- menu.html Spectral_cal -->
<h1>Spec_cal_jobb_Miracle
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Spec_cal_jobb_Miracle - Example of spectral camera sensitivity calibration</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Spec_cal_jobb_Miracle - Example of spectral camera sensitivity calibration</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../Camera/ffs_correction2.html" class="code" title="function [ff] = ffs_correction2(imgsize,optpar,optmod)">ffs_correction2</a>	FFS_CORRECTION2 - flat-field variation for optical transfer</li><li><a href="../Camera/ffs_correction_raw.html" class="code" title="function [ff] = ffs_correction_raw(imgsize,optpar,optmod)">ffs_correction_raw</a>	FFS_CORRECTION_RAW - flat-field variation for optical transfer</li><li><a href="../Fits_tools/acc2optpar.html" class="code" title="function optpar = acc2optpar(acc)">acc2optpar</a>	ACC2OPTPAR - Convert ACC-formated optical parameters to standart optpar</li><li><a href="../Fits_tools/typical_pre_proc_ops.html" class="code" title="function PO = typical_pre_proc_ops(pp_type)">typical_pre_proc_ops</a>	TYPICAL_PRE_PROC_OPS - Typical ALIS-fits preprocessing options</li><li><a href="spc_cal_bad_intens.html" class="code" title="function [gI1,gI2,gI3,gT,gX,gY,gFilter] = spc_cal_bad_intens(inI1,inI2,inI3,inT,inX,inY,inFilter,checkfilters,OPTS)">spc_cal_bad_intens</a>	SPC_CAL_BAD_INTENS - Select intensity limits for each star, and</li><li><a href="spc_cal_bad_times.html" class="code" title="function [BadTimes,sis] = spc_cal_bad_times(IDSTARS,time_s,filtnr,optpar,OPTS)">spc_cal_bad_times</a>	SPC_CAL_BAD_TIMES - Screen out bad time periods for each star</li><li><a href="spc_make_theta.html" class="code" title="function [theta_out,ze_out,ff_out,costheta] = spc_make_theta(gX,gY,optpar,sis,sz_img)">spc_make_theta</a>	SPC_MAKE_THETA - Calculate the angle from the optical axis,</li><li><a href="spc_save_bad_intens.html" class="code" title="function err = spc_save_bad_intens(gI1,gI2,gI3,gT,gX,gY,gfilter, filename)">spc_save_bad_intens</a>	SPC_SAVE_BAD_INTENS - saves bad times for spectral calibration</li><li><a href="spc_save_bad_times.html" class="code" title="function err = spc_save_bad_times(sis, BT, filename)">spc_save_bad_times</a>	SPC_SAVE_BAD_TIMES - saves bad times for spectral calibration</li><li><a href="spc_scan_for_stars.html" class="code" title="function [IDSTARS,STARPARS,filtnr,Stime,extime] = spc_scan_for_stars(files,pos,optpar,PO,OPTS,disp_ops)">spc_scan_for_stars</a>	SPC_SCAN_FOR_STARS - Scan images for stars in the Pulkovo</li><li><a href="spc_sens_hist.html" class="code" title="function [N_all,nP_all,Chi2_all] = spc_sens_hist(I_img,I_star,filter_in,filter2wl_order,hist_range)">spc_sens_hist</a>	SPC_SENS_HIST - make histogram with parametrisation and uncertainty</li><li><a href="spc_sort_out_the_bad_ones.html" class="code" title="function [GI1,GI2,GI3,GT,GX,GY,GFilter,BSC_NR,sortindx,uniqueFilters] = spc_sort_out_the_bad_ones(I_allt,all_t,all_filter,bad_times,sis,OPTS)">spc_sort_out_the_bad_ones</a>	SPC_SORT_OUT_THE_BAD_ONES  Remove stars that are "bad"</li><li><a href="spc_spectral_int_conv.html" class="code" title="function [I,dI] = spc_spectral_int_conv(wl_center,delta_wl,BSCNR,dispOPS)">spc_spectral_int_conv</a>	SPC_SPECTRAL_INT_CONV - convert Pulkovo intensity to #/cm^2/s/fw</li><li><a href="spc_typical_ops.html" class="code" title="function OPTS = spc_typical_ops">spc_typical_ops</a>	SPC_TYPICAL_OPS - Provides a struct with typical options</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Spec_cal_jobb_Miracle - Example of spectral camera sensitivity calibration</span>
0002 
0003 <span class="comment">%   Copyright ï¿½ Bjorn Gustavsson (20030901)</span>
0004 <span class="comment">%   This is free software, licensed under GNU GPL version 2 or later</span>
0005 
0006 <span class="comment">% global bx by</span>
0007 
0008 <span class="comment">%%% Somehow make the image size known</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%imgsiz = [1024 1024];</span>
0011 <span class="comment">%bx = imgsiz(2);</span>
0012 <span class="comment">%by = imgsiz(1);</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%%% Load the names of the files to scan through</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%load files0310.mat</span>
0017 <span class="comment">%files = files0310(15:end,:);</span>
0018 <span class="comment">%</span>
0019 <span class="comment">%%% Filename-base for saving (temporary) results in:</span>
0020 saveFilename = <span class="string">'SOD100221'</span>;
0021 <span class="comment">%%% Set the optical parameters</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%load S010_S10_191827_0.acc</span>
0024 <span class="comment">%optpar = S010_S10_191827_0([7:14 6 15]);</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%%% Set the long,lat position of the camera</span>
0027 <span class="comment">%</span>
0028 <span class="comment">%pos = [20.36 69.35];</span>
0029 
0030 path=<span class="string">'Sod100221/Summed/'</span>; <span class="comment">% had to add images per minute to &quot;see&quot; the stars</span>
0031                                        <span class="comment">% using the add_pngs routine</span>
0032 tmp=dir([path,<span class="string">'SOD100221*.png'</span>]);
0033 filenames=str2mat({tmp.name});
0034 pathfiles=[repmat(path,size(filenames,1),1),filenames];
0035 
0036 
0037 files = pathfiles(:,:);
0038 
0039 <span class="comment">%%% Set the optical parameters in some way:</span>
0040 <span class="comment">%</span>
0041 filename = <span class="string">'SOD_100221_00193330_____0400'</span>;
0042 load([filename, <span class="string">'.acc'</span>])
0043 <span class="comment">%optpar = acc2optpar(SOD_100221_00193330_____0400);</span>
0044 optpar = <a href="../Fits_tools/acc2optpar.html" class="code" title="function optpar = acc2optpar(acc)">acc2optpar</a>(eval(filename));
0045 
0046 <span class="comment">%%% Set the long,lat position of the observation position</span>
0047 <span class="comment">%</span>
0048 load ../.data/miraclepos.dat
0049 pos = miraclepos(1,2:3);
0050 <span class="comment">%%%%%%%</span>
0051 <span class="comment">%</span>
0052 <span class="comment">% Start of phase 1: Finding stars in images</span>
0053 <span class="comment">%</span>
0054 <span class="comment">%%%%%%%</span>
0055 
0056 <span class="comment">%% Make a structure of what typical image pre-processing options</span>
0057 <span class="comment">%% to use</span>
0058 PO = <a href="../Fits_tools/typical_pre_proc_ops.html" class="code" title="function PO = typical_pre_proc_ops(pp_type)">typical_pre_proc_ops</a>(<span class="string">'miracle_asc'</span>)
0059 PO.filetype = <span class="string">'miracle_asc'</span>;
0060 PO.medianfilter = 0;
0061 <span class="comment">%% Make a structure of options for the star search</span>
0062 o.exptime = str2num(filename(25:28));
0063 
0064 OPTS = <a href="spc_typical_ops.html" class="code" title="function OPTS = spc_typical_ops">spc_typical_ops</a>
0065 OPTS.Mag_limit=2;
0066 
0067 <span class="comment">%% Automatic search of stars from `Pulkovo Spectrophotometric</span>
0068 <span class="comment">%% Catalog' in all images</span>
0069 
0070 [IDENTSTARS,STARPARS,filtnr,Stime] = <a href="spc_scan_for_stars.html" class="code" title="function [IDSTARS,STARPARS,filtnr,Stime,extime] = spc_scan_for_stars(files,pos,optpar,PO,OPTS,disp_ops)">spc_scan_for_stars</a>(files,pos,optpar,PO,OPTS);
0071 
0072 <span class="comment">%% Check of the results - tedious and boooring</span>
0073 
0074 <span class="comment">%[ok] = check_scan_for_stars(files,pos,optpar,IDENTSTARS,STARPARS,PO,OPTS);</span>
0075 
0076 time_s = Stime(:,1)+Stime(:,2)/60+Stime(:,3)/3600;
0077 
0078 <span class="comment">%%%%%%%</span>
0079 <span class="comment">%</span>
0080 <span class="comment">% Start of phase 2: Removal of bad star-identification</span>
0081 <span class="comment">%                   or `weed out the weaklings'</span>
0082 <span class="comment">%%%%%%%</span>
0083 
0084 <span class="comment">% Determine bad time intervals for each star (due to clouds)</span>
0085 <span class="comment">%filtnr0=ones(length(filtnr));</span>
0086 <span class="comment">%[BT,sis] = spc_cal_bad_times(IDENTSTARS,time_s,filtnr0,optpar);</span>
0087 filtnr0=ones(length(filtnr));
0088 cloudy = 1;
0089 <span class="keyword">if</span> cloudy  <span class="comment">%ALWAYS set to 1 to get to the cloud selection</span>
0090   [BT, sis, err] = spc_load_bad_times([filename, <span class="string">'_bt.mat'</span>]);
0091     <span class="keyword">if</span> err ~= 0
0092       [BT,sis] = <a href="spc_cal_bad_times.html" class="code" title="function [BadTimes,sis] = spc_cal_bad_times(IDSTARS,time_s,filtnr,optpar,OPTS)">spc_cal_bad_times</a>(IDENTSTARS,time_s,filtnr0,optpar);
0093         <a href="spc_save_bad_times.html" class="code" title="function err = spc_save_bad_times(sis, BT, filename)">spc_save_bad_times</a>(sis, BT, [filename, <span class="string">'_bt'</span>])
0094     <span class="keyword">end</span>
0095 <span class="keyword">else</span>
0096   
0097   sis = 1:length(unique(IDENTSTARS(:,9)));
0098   BT = zeros([length(sis) 2]);
0099   
0100 <span class="keyword">end</span>
0101 <span class="comment">% Sort out the bad time periods and star-fits which are `off</span>
0102 <span class="comment">% course', and split IDENTSTARS into more specific matrixes.</span>
0103 [gI1,gI2,gI3,gT,gX,gY,gfilter,BSC_nr,sindx] = <a href="spc_sort_out_the_bad_ones.html" class="code" title="function [GI1,GI2,GI3,GT,GX,GY,GFilter,BSC_NR,sortindx,uniqueFilters] = spc_sort_out_the_bad_ones(I_allt,all_t,all_filter,bad_times,sis,OPTS)">spc_sort_out_the_bad_ones</a>(IDENTSTARS,time_s,filtnr,BT,sis,OPTS);
0104 
0105 <span class="comment">% remove clearly bad outliers in intensity.</span>
0106 <span class="comment">%[gI1,gI2,gI3,gT,gX,gY,gfilter,err] = ...</span>
0107 <span class="comment">%    spc_cal_bad_intens(GI1(1:length(sis),:),...</span>
0108 <span class="comment">%                       GI2(1:length(sis),:),...</span>
0109 <span class="comment">%                       GI3(1:length(sis),:),...</span>
0110 <span class="comment">%                       GT(1:length(sis),:),...</span>
0111 <span class="comment">%                       GX(1:length(sis),:),...</span>
0112 <span class="comment">%                       GY(1:length(sis),:),...</span>
0113 <span class="comment">%                       Gfilter(1:length(sis),:),...</span>
0114 <span class="comment">%                       [0 1 4 5]);</span>
0115 
0116 bad_noise_stats = 1; <span class="comment">% to reject intensity outliers</span>
0117 <span class="keyword">if</span> bad_noise_stats
0118 <span class="comment">% remove clearly bad outliers in intensity.</span>
0119     [gI1_,gI2_,gI3_,gT_,gX_,gY_,gfilter_,err] = spc_load_bad_intens([filename, <span class="string">'_bi.mat'</span>]);
0120     <span class="keyword">if</span> err ~= 0 &amp; err ~= 3
0121         [gI1,gI2,gI3,gT,gX,gY,gfilter] = <span class="keyword">...</span>
0122             <a href="spc_cal_bad_intens.html" class="code" title="function [gI1,gI2,gI3,gT,gX,gY,gFilter] = spc_cal_bad_intens(inI1,inI2,inI3,inT,inX,inY,inFilter,checkfilters,OPTS)">spc_cal_bad_intens</a>(gI1(1:length(sis),:),<span class="keyword">...</span>
0123                                gI2(1:length(sis),:),<span class="keyword">...</span>
0124                                gI3(1:length(sis),:),<span class="keyword">...</span>
0125                                gT(1:length(sis),:),<span class="keyword">...</span>
0126                                gX(1:length(sis),:),<span class="keyword">...</span>
0127                                gY(1:length(sis),:),<span class="keyword">...</span>
0128                                ones(size(gfilter(1:length(sis),:))),<span class="keyword">...</span>
0129                                1);
0130         <a href="spc_save_bad_intens.html" class="code" title="function err = spc_save_bad_intens(gI1,gI2,gI3,gT,gX,gY,gfilter, filename)">spc_save_bad_intens</a>(gI1,gI2,gI3,gT,gX,gY,gfilter, [filename, <span class="string">'_bi'</span>]);
0131     <span class="keyword">elseif</span> err == 0
0132         gI1 = gI1_;
0133         gI2 = gI2_;
0134         gI3 = gI3_;
0135         gT = gT_;
0136         gX = gX_;
0137         gY = gY_;
0138         gfilter = gfilter_;
0139     <span class="keyword">end</span>
0140 <span class="keyword">end</span>
0141 disp(<span class="string">'BLAH'</span>)
0142 <span class="comment">%%%%%%%</span>
0143 <span class="comment">%</span>
0144 <span class="comment">% Start of phase 3: Finally Physics</span>
0145 <span class="comment">%</span>
0146 <span class="comment">%%%%%%%</span>
0147 
0148 <span class="comment">% flat-field-correction matrixes</span>
0149 ffc_raw = <a href="../Camera/ffs_correction_raw.html" class="code" title="function [ff] = ffs_correction_raw(imgsize,optpar,optmod)">ffs_correction_raw</a>([bx by],optpar,optpar(9))/bx/by;
0150 ffc = <a href="../Camera/ffs_correction2.html" class="code" title="function [ff] = ffs_correction2(imgsize,optpar,optmod)">ffs_correction2</a>([bx by],optpar,optpar(9));
0151 
0152 [theta_out,gZe,gffc] = <a href="spc_make_theta.html" class="code" title="function [theta_out,ze_out,ff_out,costheta] = spc_make_theta(gX,gY,optpar,sis,sz_img)">spc_make_theta</a>(gX,gY,optpar,sis);
0153 costheta = cos(theta_out);
0154 
0155 
0156 
0157 exp_t = o.exptime;
0158 
0159 I1 = gI1 ./ gffc / exp_t;
0160 I2 = gI2 ./ gffc / exp_t;
0161 I2 = gI2 ./ costheta / exp_t;
0162 I2 = gI2 ./ costheta; 
0163 
0164 
0165 <span class="comment">% Set the centre-wavelengths of the filters</span>
0166 wl_center = [427.8 557.7 630.0 845.5]; <span class="comment">% nm</span>
0167 <span class="comment">% and the bandwidths</span>
0168 delta_wl = [2, 2, 2, 2]; <span class="comment">% nm</span>
0169 
0170 <span class="comment">% This needs modification, to tie the filter identifiers in Gfilter</span>
0171 <span class="comment">% to the corresponding wavelengths (those above in wl_center)</span>
0172 filter2wl = [5       0     1     4];
0173 filter2wl = [4278,   5577, 6300, 8446];
0174 filter2wl = [427,   557, 630, 844];
0175 
0176 <span class="comment">%%% Calculate the stellar intensities in (photons/m^2/s)?</span>
0177 [I_sis,dI] = <a href="spc_spectral_int_conv.html" class="code" title="function [I,dI] = spc_spectral_int_conv(wl_center,delta_wl,BSCNR,dispOPS)">spc_spectral_int_conv</a>(wl_center,delta_wl,BSC_nr);
0178 
0179 <span class="comment">%[N5,nP5,Chi2_5,N0,nP0,Chi2_0,N1,nP1,Chi2_1,N4,nP4,Chi2_4] = spc_sens_hist(I2,I_sis,gfilter,filter2wl,hist_range);</span>
0180 <span class="comment">% Estimate the distribution for the sensitivity in the different</span>
0181 <span class="comment">% filters. This should be in (counts/(photon/m^2/s))</span>
0182 <span class="comment">%N_all = spc_sens_pdf(I2,I_sis,gfilter,filter2wl,hist_range);</span>
0183 sens_range = [0:.01:5]/1000; <span class="comment">% Typical for ALIS</span>
0184 N_all = <a href="spc_sens_hist.html" class="code" title="function [N_all,nP_all,Chi2_all] = spc_sens_hist(I_img,I_star,filter_in,filter2wl_order,hist_range)">spc_sens_hist</a>(I2,I_sis,gfilter,filter2wl,sens_range);
0185 
0186 <span class="comment">% Then to get to surface brightness (photons/m^2/s/ster) take:</span>
0187 Brigthness_per_count = 1./mode(N_all{1:3:length(N_all)})/max(fcc_raw);
0188 
0189 <span class="comment">% Finaly convert to column emission rate/count:</span>
0190 Rayleighs_per_count = 1e-10*4*pi*Brigthness_per_count;
0191 
0192 
0193 <span class="comment">%%% example for the SP-ASI</span>
0194 <span class="comment">%exp_t = 16;</span>
0195 <span class="comment">%hist_range = [0:.01:5]/10;</span>
0196 <span class="comment">%I1 = gI1 ./ gffc / exp_t;</span>
0197 <span class="comment">%I2 = gI2 ./ gffc / exp_t;</span>
0198 <span class="comment">%I2 = gI2 ./ costheta / exp_t;</span>
0199 <span class="comment">%</span>
0200 <span class="comment">%[N1,nP1,Chi2_1,N2,nP2,Chi2_2,N3,nP3,Chi2_3] = spc_sens_hist(I2,I_sis,gfilter,hist_range);</span>
0201 <span class="comment">%</span>
0202 <span class="comment">%</span>
0203 <span class="comment">%% For heating tomografi</span>
0204 <span class="comment">%global bx by</span>
0205 <span class="comment">%</span>
0206 <span class="comment">%imgsiz = [256 256]/2;</span>
0207 <span class="comment">%bx = imgsiz(2);</span>
0208 <span class="comment">%by = imgsiz(1);</span>
0209 <span class="comment">%</span>
0210 <span class="comment">%load kuma_files</span>
0211 <span class="comment">%</span>
0212 <span class="comment">%load Abisko_heating_nostrips.opt</span>
0213 <span class="comment">%load Nikka_heating_nostrip.opt</span>
0214 <span class="comment">%load Silki_heating_nostrp.opt</span>
0215 <span class="comment">%optpar3 = [Silki_heating_nostrp 3 0];</span>
0216 <span class="comment">%optpar6 = [Nikka_heating_nostrip 3 0];</span>
0217 <span class="comment">%load alispos.dat</span>
0218 <span class="comment">%alispos = alispos.*(ones([6 1])*[1 1/60 1/3600 1 1/60 1/3600]);</span>
0219 <span class="comment">%alispos = [alispos(:,1)+alispos(:,2)+alispos(:,3) alispos(:,4)+alispos(:,5)+alispos(:,6)]</span>
0220 <span class="comment">%pos = alispos(3,:);</span>
0221 <span class="comment">%PO = typical_pre_proc_ops;</span>
0222 <span class="comment">%PO.medianfilter = 0;</span>
0223 <span class="comment">%OPTS = spc_typical_ops;</span>
0224 <span class="comment">%</span>
0225 <span class="comment">%files = F3_1740;</span>
0226 <span class="comment">%optpar = optpar3;</span>
0227 <span class="comment">%</span>
0228 <span class="comment">%[IDENTSTARS,STARPARS,filtnr,Stime] = spc_scan_for_stars(files,pos,optpar,PO,OPTS);</span>
0229 <span class="comment">%time_s = Stime(:,1)+Stime(:,2)/60+Stime(:,3)/3600;</span>
0230 <span class="comment">%filtnr(:) = 1;</span>
0231 <span class="comment">%</span>
0232 <span class="comment">%% $$$ [BT,sis] = spc_cal_bad_times(IDENTSTARS,time_s,filtnr,optpar);</span>
0233 <span class="comment">%sis = 1:length(unique(IDENTSTARS(:,9)));</span>
0234 <span class="comment">%BT = zeros([length(sis) 2]);</span>
0235 <span class="comment">%[gI1,gI2,gI3,gT,gX,gY,gfilter,BSC_nr,sindx] = spc_sort_out_the_bad_ones(IDENTSTARS,time_s,filtnr,BT,sis);</span>
0236 <span class="comment">%ffc = ffs_correction2([bx by],optpar,optpar(9));</span>
0237 <span class="comment">%</span>
0238 <span class="comment">%[theta_out,gZe,gffc] = spc_make_theta(gX,gY,optpar,sis);</span>
0239 <span class="comment">%costheta = cos(theta_out);</span>
0240 <span class="comment">%wl_center = 630;</span>
0241 <span class="comment">%delta_wl = 4;</span>
0242 <span class="comment">%%%% Calculate the stellar intensities in (FIXME!!!!!) unit</span>
0243 <span class="comment">%[I_sis,dI] = spc_spectral_int_conv(wl_center,delta_wl,BSC_nr);</span>
0244 <span class="comment">%</span>
0245 <span class="comment">%%%% example for ALIS</span>
0246 <span class="comment">%[d,h,o] = inimg(files(2,:),PO);</span>
0247 <span class="comment">%exp_t = o.exptime;</span>
0248 <span class="comment">%hist_range = [0:.01:5]/10;</span>
0249 <span class="comment">%I1 = gI1 ./ gffc / exp_t;</span>
0250 <span class="comment">%I2 = gI2 ./ gffc / exp_t;</span>
0251 <span class="comment">%I2 = gI2 ./ costheta / exp_t;</span>
0252 <span class="comment">%</span>
0253 <span class="comment">%[N1_3,nP1_3,Chi2_1_3] = spc_sens_hist(I2,I_sis,gfilter,hist_range);</span>
0254 <span class="comment">%</span>
0255 <span class="comment">%</span>
0256 <span class="comment">%files = F6_1740;</span>
0257 <span class="comment">%optpar = optpar6;</span>
0258 <span class="comment">%pos = alispos(6,:);</span>
0259 <span class="comment">%</span>
0260 <span class="comment">%[IDENTSTARS,STARPARS,filtnr,Stime] = spc_scan_for_stars(files,pos,optpar,PO,OPTS);</span>
0261 <span class="comment">%time_s = Stime(:,1)+Stime(:,2)/60+Stime(:,3)/3600;</span>
0262 <span class="comment">%filtnr(:) = 1;</span>
0263 <span class="comment">%% $$$ [BT,sis] = spc_cal_bad_times(IDENTSTARS,time_s,filtnr,optpar);</span>
0264 <span class="comment">%sis = 1:length(unique(IDENTSTARS(:,9)));</span>
0265 <span class="comment">%BT = zeros([length(sis) 2]);</span>
0266 <span class="comment">%[gI1,gI2,gI3,gT,gX,gY,gfilter,BSC_nr,sindx] = spc_sort_out_the_bad_ones(IDENTSTARS,time_s,filtnr,BT,sis);</span>
0267 <span class="comment">%ffc = ffs_correction2([bx by],optpar,optpar(9));</span>
0268 <span class="comment">%</span>
0269 <span class="comment">%[theta_out,gZe,gffc] = spc_make_theta(gX,gY,optpar,sis);</span>
0270 <span class="comment">%costheta = cos(theta_out);</span>
0271 <span class="comment">%</span>
0272 <span class="comment">%%%% Calculate the stellar intensities in (FIXME!!!!!) unit</span>
0273 <span class="comment">%[I_sis,dI] = spc_spectral_int_conv(wl_center,delta_wl,BSC_nr);</span>
0274 <span class="comment">%</span>
0275 <span class="comment">%%%% example for ALIS</span>
0276 <span class="comment">%[d,h,o] = inimg(files(2,:),PO);</span>
0277 <span class="comment">%exp_t = o.exptime;</span>
0278 <span class="comment">%hist_range = [0:.01:5]/10;</span>
0279 <span class="comment">%I1 = gI1 ./ gffc / exp_t;</span>
0280 <span class="comment">%I2 = gI2 ./ gffc / exp_t;</span>
0281 <span class="comment">%I2 = gI2 ./ costheta / exp_t;</span>
0282 <span class="comment">%</span>
0283 <span class="comment">%[N1_6,nP1_6,Chi2_1_6] = spc_sens_hist(I2,I_sis,gfilter,hist_range);</span></pre></div>
<hr><address>Generated on Sat 09-Feb-2013 12:20:36 by <strong>B.&nbsp;Gustavsson</strong> with <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>